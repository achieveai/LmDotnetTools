# Sample Test Prompts

These prompts can be pasted into the chat to test tool calls and mode switching
using the mock LLM (TestSseMessageHandler).

## Format

The mock instruction format is:
<|instruction_start|>{"instruction_chain":[...]}<|instruction_end|>

---

## Tool Test Prompts

### Calculate Tool

Basic addition:
<|instruction_start|>{"instruction_chain":[{"id":"calc-add","id_message":"Adding numbers","messages":[{"tool_call":[{"name":"calculate","args":{"a":10,"operation":"add","b":5}}]}]}]}<|instruction_end|>

Multiplication:
<|instruction_start|>{"instruction_chain":[{"id":"calc-mul","id_message":"Multiplying","messages":[{"tool_call":[{"name":"calculate","args":{"a":7,"operation":"multiply","b":6}}]}]}]}<|instruction_end|>

Division:
<|instruction_start|>{"instruction_chain":[{"id":"calc-div","id_message":"Dividing","messages":[{"tool_call":[{"name":"calculate","args":{"a":100,"operation":"divide","b":4}}]}]}]}<|instruction_end|>

### Weather Tool

Get weather for a city:
<|instruction_start|>{"instruction_chain":[{"id":"weather-city","id_message":"Checking weather","messages":[{"tool_call":[{"name":"get_weather","args":{"location":"Seattle"}}]}]}]}<|instruction_end|>

### Web Search Tool

Search for a topic:
<|instruction_start|>{"instruction_chain":[{"id":"search-topic","id_message":"Searching","messages":[{"tool_call":[{"name":"web_search","args":{"query":"machine learning","numResults":3}}]}]}]}<|instruction_end|>

### Multiple Tool Calls in One Message

Calculator then weather:
<|instruction_start|>{"instruction_chain":[{"id":"multi-tools","id_message":"Using multiple tools","messages":[{"tool_call":[{"name":"calculate","args":{"a":32,"operation":"multiply","b":1.8}},{"name":"get_weather","args":{"location":"Tokyo"}}]}]}]}<|instruction_end|>

### Pill Overflow (>3 Items in MetadataPill)

MetadataPill shows "Show all N items" when there are more than 3 pill items.
Each reasoning block = 1 item. Each tool_call message entry = 1 item.
A single tool_call array with multiple tools = 1 item (labeled "Tools: N calls").

4 pill items (reasoning + 3 separate tool_call entries — triggers "Show all 4 items"):
<|instruction_start|>{"instruction_chain":[{"id":"pill-overflow-4","reasoning":{"length":30},"id_message":"Four pill items","messages":[{"tool_call":[{"name":"calculate","args":{"a":10,"operation":"add","b":5}}]},{"tool_call":[{"name":"get_weather","args":{"location":"Seattle"}}]},{"tool_call":[{"name":"calculate","args":{"a":7,"operation":"multiply","b":6}}]}]}]}<|instruction_end|>

5 pill items (reasoning + 4 tool_call entries including web_search — triggers "Show all 5 items"):
<|instruction_start|>{"instruction_chain":[{"id":"pill-overflow-5","reasoning":{"length":40},"id_message":"Five pill items","messages":[{"tool_call":[{"name":"calculate","args":{"a":100,"operation":"divide","b":4}}]},{"tool_call":[{"name":"get_weather","args":{"location":"London"}}]},{"tool_call":[{"name":"web_search","args":{"query":"temperature conversion","numResults":2}}]},{"tool_call":[{"name":"get_weather","args":{"location":"Paris"}}]}]}]}<|instruction_end|>

All three tool types in one turn (calculate + get_weather + web_search as separate pills):
<|instruction_start|>{"instruction_chain":[{"id":"all-three-tools","id_message":"All tool types","messages":[{"tool_call":[{"name":"calculate","args":{"a":42,"operation":"multiply","b":2}}]},{"tool_call":[{"name":"get_weather","args":{"location":"Chicago"}}]},{"tool_call":[{"name":"web_search","args":{"query":"best deep dish pizza","numResults":3}}]}]}]}<|instruction_end|>

### Reasoning-Only Messages

Tests the ThinkingPill (brain emoji, truncated preview, expand/collapse) without tool calls.

Short reasoning (20 words) followed by text:
<|instruction_start|>{"instruction_chain":[{"id":"reason-short","reasoning":{"length":20},"id_message":"Short thinking","messages":[{"text_message":{"length":30}}]}]}<|instruction_end|>

Long reasoning (100 words) followed by text:
<|instruction_start|>{"instruction_chain":[{"id":"reason-long","reasoning":{"length":100},"id_message":"Long thinking","messages":[{"text_message":{"length":50}}]}]}<|instruction_end|>

### Reasoning + Tool Calls (Mixed MetadataPill)

Tests reasoning and tool calls appearing as separate expandable rows in the same pill.

3 pill items — reasoning + 2 tool calls (no overflow):
<|instruction_start|>{"instruction_chain":[{"id":"mixed-3","reasoning":{"length":40},"id_message":"Mixed pill 3 items","messages":[{"tool_call":[{"name":"calculate","args":{"a":15,"operation":"add","b":25}}]},{"tool_call":[{"name":"get_weather","args":{"location":"Berlin"}}]}]}]}<|instruction_end|>

5 pill items — reasoning + 4 tool calls including web_search (with overflow):
<|instruction_start|>{"instruction_chain":[{"id":"mixed-5","reasoning":{"length":50},"id_message":"Mixed pill 5 items","messages":[{"tool_call":[{"name":"calculate","args":{"a":1,"operation":"add","b":1}}]},{"tool_call":[{"name":"web_search","args":{"query":"NYC weather history","numResults":2}}]},{"tool_call":[{"name":"get_weather","args":{"location":"NYC"}}]},{"tool_call":[{"name":"get_weather","args":{"location":"LA"}}]}]}]}<|instruction_end|>

### Long Text Responses

Tests streaming cursor, markdown rendering, and scroll behavior with large responses.

Long text response (200 words):
<|instruction_start|>{"instruction_chain":[{"id":"long-text","id_message":"Long response","messages":[{"text_message":{"length":200}}]}]}<|instruction_end|>

Multi-turn: tool call then long text summary (300 words):
<|instruction_start|>{"instruction_chain":[{"id":"long-turn1","id_message":"Gathering data","messages":[{"tool_call":[{"name":"get_weather","args":{"location":"Tokyo"}}]}]},{"id":"long-turn2","id_message":"Long summary","messages":[{"text_message":{"length":300}}]}]}<|instruction_end|>

### Weather Emoji Conditions

The mock SampleTools.GetWeather returns random conditions from:
["Sunny", "Cloudy", "Partly Cloudy", "Rainy", "Clear"]

WeatherToolPill maps each to an emoji. Send this prompt repeatedly to see different conditions:
<|instruction_start|>{"instruction_chain":[{"id":"weather-emoji","id_message":"Weather check","messages":[{"tool_call":[{"name":"get_weather","args":{"location":"Denver"}}]}]}]}<|instruction_end|>

### Multiturn Example (multiple turns with reasoning)

<|instruction_start|>{"instruction_chain":[{"id":"turn1_parallel_tools","reasoning":{"length":30},"messages":[{"tool_call":[{"name":"get_weather","args":{"location":"Seattle"}},{"name":"get_weather","args":{"location":"San Francisco"}}]}]},{"id":"turn2_final","reasoning":{"length":50},"messages":[{"tool_call":[{"name":"get_weather","args":{"location":"Seattle"}}]},{"text_message":{"length":50}}]},{"id":"turn3_summary","reasoning":{"length":10},"messages":[{"text_message":{"length":100}}]}]}<|instruction_end|>

---

## Mode Filtering Test Prompts

Use these to verify that modes correctly restrict available tools.
Note: You can switch modes mid-conversation using the dropdown at the top right.
The new mode's tools and system prompt will apply to the very next message.

### Math Helper Mode (only `calculate` allowed)

Should SUCCEED - calculate is allowed:
<|instruction_start|>{"instruction_chain":[{"id":"math-ok","id_message":"Math mode calc test","messages":[{"tool_call":[{"name":"calculate","args":{"a":25,"operation":"add","b":17}}]}]}]}<|instruction_end|>

Should FAIL - get_weather is NOT allowed in Math Helper:
<|instruction_start|>{"instruction_chain":[{"id":"math-blocked","id_message":"Math mode weather test","messages":[{"tool_call":[{"name":"get_weather","args":{"location":"NYC"}}]}]}]}<|instruction_end|>

Should FAIL - web_search is NOT allowed in Math Helper:
<|instruction_start|>{"instruction_chain":[{"id":"math-blocked2","id_message":"Math mode search test","messages":[{"tool_call":[{"name":"web_search","args":{"query":"test"}}]}]}]}<|instruction_end|>

### Weather Assistant Mode (only `get_weather` allowed)

Should SUCCEED - get_weather is allowed:
<|instruction_start|>{"instruction_chain":[{"id":"weather-ok","id_message":"Weather mode weather test","messages":[{"tool_call":[{"name":"get_weather","args":{"location":"London"}}]}]}]}<|instruction_end|>

Should FAIL - calculate is NOT allowed in Weather Assistant:
<|instruction_start|>{"instruction_chain":[{"id":"weather-blocked","id_message":"Weather mode calc test","messages":[{"tool_call":[{"name":"calculate","args":{"a":5,"operation":"add","b":3}}]}]}]}<|instruction_end|>

### General Assistant Mode (all tools allowed)

All tools should SUCCEED:
<|instruction_start|>{"instruction_chain":[{"id":"general-all","id_message":"General mode all tools","messages":[{"tool_call":[{"name":"calculate","args":{"a":10,"operation":"multiply","b":3}},{"name":"get_weather","args":{"location":"Paris"}},{"name":"web_search","args":{"query":"hello world"}}]}]}]}<|instruction_end|>

---

## System Prompt Verification

Use these prompts to verify that the correct system prompt is being used for each mode.
The `system_prompt_echo` instruction returns the current system prompt as text.

### Echo System Prompt (works in any mode)

Returns the full system prompt for the current mode:
<|instruction_start|>{"instruction_chain":[{"id":"sys-prompt","id_message":"Echoing system prompt","messages":[{"system_prompt_echo":{}}]}]}<|instruction_end|>

### System Prompt with Explanation

Echo system prompt followed by a text message:
<|instruction_start|>{"instruction_chain":[{"id":"sys-prompt-explain","id_message":"System prompt check","messages":[{"system_prompt_echo":{}},{"text_message":{"length":50}}]}]}<|instruction_end|>

The system prompts per mode are:
- General Assistant: "You are a helpful assistant with access to weather, calculator, and web search tools..."
- Math Helper: "You are a math assistant. Help users with calculations..."
- Weather Assistant: "You are a weather assistant. Help users get weather information..."

---

## Tool Call List Verification

Use these prompts to verify which tools are available in the current mode.
The `tools_list` instruction returns the names of all visible tools.

### List Available Tools (works in any mode)

Returns the list of tools available in the current mode:
<|instruction_start|>{"instruction_chain":[{"id":"tools-list","id_message":"Listing available tools","messages":[{"tools_list":{}}]}]}<|instruction_end|>

### Tools List with Explanation

List tools followed by a text explanation:
<|instruction_start|>{"instruction_chain":[{"id":"tools-explain","id_message":"Checking tools","messages":[{"tools_list":{}},{"text_message":{"length":30}}]}]}<|instruction_end|>

### Combined: System Prompt + Tools List

Verify both system prompt and available tools together:
<|instruction_start|>{"instruction_chain":[{"id":"full-verification","id_message":"Full mode verification","messages":[{"system_prompt_echo":{}},{"tools_list":{}},{"text_message":{"length":20}}]}]}<|instruction_end|>

Expected tool lists per mode:
- General Assistant: calculate, get_weather, web_search
- Math Helper: calculate
- Weather Assistant: get_weather

---

## Expected Behavior

When a tool is allowed in the current mode:
- The tool call executes and returns a result (weather data, calculation, etc.)

When a tool is blocked in the current mode:
- Server log: "No handler registered for function '{name}'. Available functions: [...]"
- Tool result: {"error":"Unknown function: {name}","available_functions":[...]}
- The LLM receives the error and responds with text (turn 2 has no tool calls)

---

## Server-Side Tool Examples (Anthropic Built-in Tools)

These require `test-anthropic` mode and the "Research Assistant" mode (or any mode with built-in tools).

### Web Search with Citations (single result)

<|instruction_start|>{"id":"test-server-tools","messages":[{"server_tool_use":{"name":"web_search","input":{"query":"quantum computing advances"}}},{"server_tool_result":{"name":"web_search","result":{"type":"web_search_result","search_results":[{"title":"Quantum Computing Breakthroughs 2026","url":"https://example.com/quantum","encrypted_content":"bW9jaw==","page_age":"3 days ago"}]}}},{"text_with_citations":{"text":"Recent advances in quantum computing include error correction breakthroughs and new qubit architectures.","citations":[{"type":"web_search_result_location","url":"https://example.com/quantum","title":"Quantum Computing Breakthroughs 2026","cited_text":"error correction breakthroughs and new qubit architectures"}]}}]}<|instruction_end|>

### Web Search with Multiple Citations

<|instruction_start|>{"id":"test-multi-citations","messages":[{"server_tool_use":{"name":"web_search","input":{"query":"AI trends 2026"}}},{"server_tool_result":{"name":"web_search","result":{"type":"web_search_result","search_results":[{"title":"AI Trends Report 2026","url":"https://example.com/ai-trends","encrypted_content":"bW9jaw==","page_age":"1 day ago"},{"title":"Machine Learning Advances","url":"https://example.org/ml","encrypted_content":"bW9jaw==","page_age":"5 days ago"}]}}},{"text_with_citations":{"text":"AI continues to evolve rapidly in 2026. Large language models have become more efficient and capable. New architectures are pushing the boundaries of what's possible.","citations":[{"type":"web_search_result_location","url":"https://example.com/ai-trends","title":"AI Trends Report 2026","cited_text":"Large language models have become more efficient"},{"type":"web_search_result_location","url":"https://example.org/ml","title":"Machine Learning Advances","cited_text":"New architectures are pushing the boundaries"}]}}]}<|instruction_end|>

### Multi-Turn: Mixed Function Tools + Server Tools (3 steps)

Step 1: calculate + get_weather (function tools) and web_search (server tool)
Step 2: web_search (server tool) and calculate (function tool)
Step 3: text with citations summarizing the search results

<|instruction_start|>{"instruction_chain":[{"id":"step1-calc-weather-search","id_message":"Step 1: Gathering data","messages":[{"tool_call":[{"name":"calculate","args":{"a":273.15,"operation":"add","b":100}},{"name":"get_weather","args":{"location":"Tokyo"}}]},{"server_tool_use":{"name":"web_search","input":{"query":"Tokyo climate data 2026"}}},{"server_tool_result":{"name":"web_search","result":{"type":"web_search_result","search_results":[{"title":"Tokyo Climate Report 2026","url":"https://example.com/tokyo-climate","encrypted_content":"bW9jaw==","page_age":"2 days ago"},{"title":"Japan Weather Patterns","url":"https://example.org/japan-weather","encrypted_content":"bW9jaw==","page_age":"1 week ago"}]}}}]},{"id":"step2-search-calc","id_message":"Step 2: Additional research","messages":[{"server_tool_use":{"name":"web_search","input":{"query":"Kelvin to Celsius conversion formula"}}},{"server_tool_result":{"name":"web_search","result":{"type":"web_search_result","search_results":[{"title":"Temperature Conversion Guide","url":"https://example.com/temp-conversion","encrypted_content":"bW9jaw==","page_age":"3 months ago"}]}}},{"tool_call":[{"name":"calculate","args":{"a":373.15,"operation":"add","b":-273.15}}]}]},{"id":"step3-summary","id_message":"Step 3: Summary with citations","messages":[{"text_with_citations":{"text":"Based on my research, Tokyo's current temperature is moderate. The calculation shows that 273.15 + 100 = 373.15 Kelvin, which converts to exactly 100 degrees Celsius. Tokyo's climate in 2026 continues to follow historical patterns with warm summers and mild winters.","citations":[{"type":"web_search_result_location","url":"https://example.com/tokyo-climate","title":"Tokyo Climate Report 2026","cited_text":"Tokyo's climate in 2026 continues to follow historical patterns"},{"type":"web_search_result_location","url":"https://example.com/temp-conversion","title":"Temperature Conversion Guide","cited_text":"373.15 Kelvin converts to exactly 100 degrees Celsius"}]}}]}]}<|instruction_end|>

### Expected UI Components for Server Tools
1. Web search pill - collapsible bar with magnifying glass icon showing "web_search: web_search"
2. Text with citations - response text rendered as a paragraph
3. Sources section - "Sources:" heading with bulleted list of clickable citation links
4. Token usage bar - "Tokens: 100 in / 50 out" at the bottom

---

## Normal Text Messages

Simple text message:
Some text message

Message with reasoning:
Some text message
Reason: Reason about something

---

## Reference

For instruction chain parser details, see:
src/LmTestUtils/TestMode/InstructionChainParser.cs
